<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>slots与children</title>
</head>
<style>
    .foo{
        font-size:18px;
        color: red;
    }
</style>
<body>
<div id="app">
    <my-component :level="4">www.baidu.com
        <p slot="foo">first</p>
        <p>second</p>
    </my-component>
    <br/>
    <my-component2 :level="4">www.baidu.com
        <p slot="foo">first</p>
        <p>second</p>
    </my-component2>
</div>
</body>
<script src="../../lib/vue2.1.3.js"></script>
<script>
    /**
     * 1.http://cn.vuejs.org/v2/guide/render-function.html#基础
     * 2.对于这个组件，children 会给你两个段落标签，而 slots().default 只会传递第二个匿名段落标签，slots().foo 会传递第一个具名段落标签。同时拥有 children 和 slots() ，因此你可以选择让组件通过 slot() 系统分发或者简单的通过 children 接收，让其他组件去处理。
     * */
    var getChildrenTextContent = function(children) {
        return children.map(function(node) {
            return node.children ? getChildrenTextContent(node.children) : node.text
        }).join("");
    }
    var myComponent1 = Vue.extend({
        render: function(createElement){
            var headingId = getChildrenTextContent(this.$slots.default).toLowerCase().replace(/\W+/g,"-").replace(/(^\|\-$-)/g,"");
            return createElement(
                    "h"+this.level,
                    [
                        createElement("a",{//这是创建a标签
                            attrs: {
                                name: headingId,
                                href: "#"+headingId
                            },
                            class: {
                                foo: true
                            },
                            on: {
                                click: this.clickHandler
                            }
                        },this.$slots.default)//this.$slots.foo，传递的是slot标记为foo的标签，即first（连本身createElement创建的a标签都不存在，被覆盖掉了）
//                        },this.$slots.default)//this.$slots.default默认传递的是第二个匿名段落标签，即second
                    ]
            )
        },
        props: {
            level: {
                type: Number,
                required: true
            }
        },
        methods: {
            clickHandler: function() {
                console.log("clickHandler点击事件");
            }
        }
    })
    var myComponent2 = Vue.extend({
        functional: true,
        render: function(createElement,context){
            var headingId = getChildrenTextContent(context.children).toLowerCase().replace(/\W+/g,"-").replace(/(^\|\-$-)/g,"");
            return createElement(
                    "h"+this.level,
                    [
                        createElement("a",{//这是创建a标签
                            attrs: {
                                name: headingId,
                                href: "#"+headingId
                            },
                            class: {
                                foo: true
                            },
                            on: {
                                click: this.clickHandler
                            }
                        },context.children)//context.children获取到的是所有的段落，包括匿名的second，也包括不匿名的first，当然也存在本身createElement创建的a标签
                    ]
            )
        },
        props: {
            level: {
                type: Number,
                required: true
            }
        },
        methods: {
            clickHandler: function() {
                console.log("clickHandler点击事件");
            }
        }
    })
    new Vue({
        el: "#app",
        components: {
            "my-component": myComponent1,
            "my-component2": myComponent2
        }
    })

</script>
</html>