<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>组件vue2.js</title>
    <meta key="http://cn.vuejs.org/v2/guide/components.html#currency-input-example">
</head>
<body>

<script src="../lib/vue2.1.3.js"></script>
<script src="../lib/util/currency-validator.js"></script>
<div id="app">
    <currency-input :label="成本价格Price" v-model="price"></currency-input>
    <currency-input label="Shipping运费" v-model="shipping"></currency-input>
    <currency-input label="Handling提货价" v-model="handling"></currency-input>
    <currency-input label="Discount折扣" v-model="discount"></currency-input>
    <p>Total: ${{total}}</p>
</div>
<template id="J_currency">
    <div>
        <label v-if="label">{{label}}</label>
        $<input ref="input" v-bind:value="value" v-on:input="updateValue($event.target.value)" v-on:focus="selectAll" v-on:blur="formatValue">
    </div>
</template>
</body>
<script>
    Vue.component('currency-input', {
        template: /*'\
    <div>\
      <label v-if="label">{{ label }}</label>\
      $\
      <input\
        ref="input"\
        v-bind:value="value"\
        v-on:input="updateValue($event.target.value)"\
        v-on:focus="selectAll"\
        v-on:blur="formatValue"\
      >\
    </div>\
  ',*/"#J_currency",
        props: {
            value: {
                type: Number,
                default: 0
            },
            label: {
                type: String,
                default: '选项label默认名：'
            }
        },
        mounted: function () {
            this.formatValue()
        },
        methods: {
            updateValue: function (value) {
                var result = currencyValidator.parse(value, this.value)
                if (result.warning) {
                    this.$refs.input.value = result.value
                }
                this.$emit('input', result.value)
            },
            formatValue: function () {
                this.$refs.input.value = currencyValidator.format(this.value)
            },
            selectAll: function (event) {
                // Workaround for Safari bug
                // http://stackoverflow.com/questions/1269722/selecting-text-on-focus-using-jquery-not-working-in-safari-and-chrome
                setTimeout(function () {
                    event.target.select()
                }, 0)
            }
        }
    })

    new Vue({
        el: '#app',
        data: {
            price: 0,
            shipping: 0,
            handling: 0,
            discount: 0
        },
        computed: {
            total: function () {
                return ((
                        this.price * 100 +
                        this.shipping * 100 +
                        this.handling * 100 -
                        this.discount * 100
                ) / 100).toFixed(2)
            }
        }
    })
</script>
</html>